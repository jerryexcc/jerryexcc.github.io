<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF çŒœæ‹³éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <style>
      body { font-family: 'Noto Sans TC', sans-serif; }
      .rps-card { @apply bg-white p-8 rounded-3xl shadow-2xl w-full max-w-sm text-center border-t-8 border-green-500; }
      .btn-choice { @apply flex-1 py-6 text-5xl rounded-2xl bg-slate-50 hover:bg-green-50 border-2 border-transparent hover:border-green-300 transition-all active:scale-90 shadow-sm flex items-center justify-center; }
    </style>
  </head>
  <body class="bg-slate-100 min-h-screen flex items-center justify-center p-6">

    <div class="rps-card">
      <h1 class="text-2xl font-black text-slate-800 mb-2">LIFF çŒœæ‹³æŒ‘æˆ°</h1>
      <p id="status" class="text-sm font-bold text-amber-500 mb-8">æ­£åœ¨å•Ÿå‹• LINE ç’°å¢ƒ...</p>

      <div id="game-ui" class="flex gap-3 mb-10 opacity-50 pointer-events-none">
        <button onclick="play('çŸ³é ­', 'âœŠ')" class="btn-choice">âœŠ</button>
        <button onclick="play('å‰ªåˆ€', 'âœŒï¸')" class="btn-choice">âœŒï¸</button>
        <button onclick="play('å¸ƒ', 'ğŸ–ï¸')" class="btn-choice">ğŸ–ï¸</button>
      </div>

      <div id="result-box" class="hidden">
        <div id="result-text" class="text-4xl font-black mb-2 text-slate-700"></div>
        <p class="text-xs text-slate-400">æ­£åœ¨å‚³é€çµæœè‡³èŠå¤©å®¤...</p>
      </div>
    </div>

    <script>
      // ğŸ’¡ è«‹ç¢ºä¿é€™æ˜¯ä½  Login Channel è£¡çš„ LIFF ID
      const LIFF_ID = '2007872114-9BQqsRof';

      async function initLiff() {
        const statusEl = document.getElementById('status');
        try {
          await liff.init({ liffId: LIFF_ID });
          
          if (!liff.isLoggedIn()) {
            liff.login();
          } else {
            const profile = await liff.getProfile();
            statusEl.innerText = `ğŸ® ä½ å¥½ï¼Œ${profile.displayName}ï¼è«‹å‡ºæ‹³`;
            statusEl.classList.replace('text-amber-500', 'text-green-600');
            
            // è§£é–éŠæˆ²ä»‹é¢
            document.getElementById('game-ui').classList.remove('opacity-50', 'pointer-events-none');
          }
        } catch (err) {
          statusEl.innerText = "âŒ LIFF åˆå§‹åŒ–å¤±æ•—: " + err.message;
          console.error(err);
        }
      }

      function play(userChoice, emoji) {
        const choices = ['çŸ³é ­', 'å‰ªåˆ€', 'å¸ƒ'];
        const botChoice = choices[Math.floor(Math.random() * 3)];
        const botEmoji = botChoice === 'çŸ³é ­' ? 'âœŠ' : (botChoice === 'å‰ªåˆ€' ? 'âœŒï¸' : 'ğŸ–ï¸');
        
        let result = "";
        if (userChoice === botChoice) result = "å¹³æ‰‹";
        else if (
          (userChoice === 'çŸ³é ­' && botChoice === 'å‰ªåˆ€') ||
          (userChoice === 'å‰ªåˆ€' && botChoice === 'å¸ƒ') ||
          (userChoice === 'å¸ƒ' && botChoice === 'çŸ³é ­')
        ) result = "è´";
        else result = "è¼¸";

        showResult(result, userChoice, emoji, botEmoji);
      }

      function showResult(result, userChoice, userEmoji, botEmoji) {
        const uiEl = document.getElementById('game-ui');
        const resultBox = document.getElementById('result-box');
        const resultText = document.getElementById('result-text');

        uiEl.classList.add('opacity-50', 'pointer-events-none');
        resultBox.classList.remove('hidden');
        
        if (result === 'è´') resultText.innerText = "ä½ è´äº†ï¼ğŸ†";
        else if (result === 'å¹³æ‰‹') resultText.innerText = "å¹³æ‰‹ ğŸ˜";
        else resultText.innerText = "ä½ è¼¸äº† ğŸ’€";

        // ğŸ’¡ é€é LIFF ç™¼é€è¨Šæ¯å›èŠå¤©å®¤
        sendResultMessage(result, userEmoji, botEmoji);
      }

      function sendResultMessage(result, userEmoji, botEmoji) {
        if (!liff.isInClient()) {
          alert("ç›®å‰ä¸åœ¨ LINE App ä¸­ï¼Œç„¡æ³•ç™¼é€è¨Šæ¯ï¼ŒéŠæˆ²çµæŸï¼");
          return;
        }

        const message = `æˆ‘åœ¨çŒœæ‹³æŒ‘æˆ°ä¸­æ‰“å‡ºäº† ${userEmoji}\né›»è…¦å‡ºçš„æ˜¯ ${botEmoji}\nçµæœï¼šæˆ‘${result}äº†ï¼`;

        liff.sendMessages([{
          type: 'text',
          text: message
        }])
        .then(() => {
          console.log("è¨Šæ¯å‚³é€æˆåŠŸ");
          // ç™¼é€æˆåŠŸå¾Œå»¶é² 1.5 ç§’è‡ªå‹•é—œé–‰è¦–çª—ï¼Œå„ªåŒ–é«”é©—
          setTimeout(() => liff.closeWindow(), 1500);
        })
        .catch((err) => {
          console.error("ç™¼é€å¤±æ•—", err);
          alert("è¨Šæ¯ç™¼é€å¤±æ•—ï¼Œè«‹ç¢ºèªæ˜¯å¦å·²é–‹å•Ÿ chat_message.write æ¬Šé™");
        });
      }

      window.onload = initLiff;
    </script>
  </body>
</html>